/* 항상 라이트 팔레트 유지 (다크 모드여도 동일하게 표시) */
html, body{
  color-scheme: light !important;
  background:#f5f7fb !important;
}
@media (prefers-color-scheme: dark){
  html{ color-scheme: light !important; }
  :root{
    --bg:#f5f7fb !important;
    --card:#ffffff !important;
    --text:#1f2937 !important;
    --muted:#6b7280 !important;
    --brand:#7caaeb !important;
    --brand-dark:#5d96dc !important;
    --ai:#eef3ff !important;
    --user:#7caaeb !important;
    --ring:rgba(124,170,235,.45) !important;
  }
}

/* 라이트 모드 기준 색상 고정 */
:root{
  --bg:#f5f7fb;
  --card:#ffffff;
  --text:#1f2937;
  --muted:#6b7280;
  --brand:#7caaeb;
  --brand-dark:#5d96dc;
  --ai:#eef3ff;
  --user:#7caaeb;
  --ring:rgba(124,170,235,.45);
  --shadow:0 14px 44px rgba(16,24,40,.12);
  --shadow-hover:0 18px 60px rgba(16,24,40,.18);
}

/* 배경 */
.chat-container{
  min-height:100vh;
  display:grid;
  place-items:center;
  padding:24px;
  background:
    radial-gradient(1100px 500px at 12% -8%, #eaf2ff 0%, transparent 60%),
    radial-gradient(900px 450px at 110% 0%, #f6e9ff 0%, transparent 55%),
    linear-gradient(180deg, var(--bg), var(--bg));
  font-family:'Poppins', system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
}

/* 글래스 카드 */
.chat-box{
  width:100%;
  max-width:860px;
  height:80vh;
  background:linear-gradient(180deg, rgba(255,255,255,.75), rgba(255,255,255,.66)), var(--card);
  backdrop-filter: blur(10px);
  border:1px solid rgba(125,125,125,.10);
  border-radius:20px;
  box-shadow:var(--shadow);
  padding:16px;
  display:flex;
  flex-direction:column;
  position:relative;
  overflow:hidden;
}

/* 상단바 */
.chat-header{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:8px;
  font-size:1.15rem;
  font-weight:800;
  color:var(--text);
  padding:4px 36px;
  min-height:46px;
  position:relative;
}
.header-sub{
  position:absolute; right:12px; top:8px;
  font-size:.85rem; color:var(--muted);
}

/* 종료 버튼 */
.exit-button{
  position:absolute; top:10px; left:10px;
  background:linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.86));
  border:1px solid rgba(125,125,125,.16);
  color:#e64949;
  padding:6px 10px;
  border-radius:12px;
  font-size:1rem;
  cursor:pointer;
  box-shadow:0 8px 18px rgba(0,0,0,.06);
  transition:transform .12s ease, box-shadow .2s ease, filter .2s ease;
  z-index:2;
}
.exit-button:hover{ transform:translateY(-1px); box-shadow:0 12px 26px rgba(0,0,0,.10); }
.exit-button:focus-visible{ outline:none; box-shadow:0 0 0 4px var(--ring); }

/* 토픽 선택 오버레이 */
.topic-selection{
  position:absolute; inset:0;
  backdrop-filter: blur(2px);
  display:grid; place-items:center;
  padding:20px;
  z-index:3;
}
.topic-card{
  width:min(640px, 92%);
  background:linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.86));
  border:1px solid rgba(125,125,125,.12);
  border-radius:16px;
  box-shadow:var(--shadow);
  padding:18px;
}
.topic-card h3{
  margin:0 0 8px; text-align:center; color:var(--text); font-size:1.25rem; font-weight:800;
}
.topic-grid{
  display:grid; grid-template-columns:repeat(2, minmax(0,1fr));
  gap:12px; margin-top:10px;
}
@media (max-width:560px){ .topic-grid{ grid-template-columns:1fr; } }

.topic-btn{
  display:flex; align-items:center; gap:10px;
  padding:14px;
  border-radius:14px;
  border:1px solid rgba(125,125,125,.12);
  background:linear-gradient(180deg, rgba(255,255,255,.98), rgba(255,255,255,.92));
  cursor:pointer; font-weight:700; color:var(--text);
  box-shadow:0 8px 20px rgba(16,24,40,.06);
  transition: transform .12s ease, box-shadow .2s ease, border-color .2s ease;
}
.topic-btn:hover{ transform:translateY(-1px); box-shadow:var(--shadow-hover); border-color:rgba(125,125,125,.18); }
.topic-emoji{ font-size:1.2rem; width:40px; height:40px; display:grid; place-items:center; border-radius:12px;
  background: linear-gradient(180deg, #eef5ff, #eaf2ff); border:1px solid rgba(125,125,125,.10); }

/* 메시지 영역 */
.chat-messages{
  display:flex; flex-direction:column; gap:10px;
  flex:1; margin:6px 0 12px; overflow-y:auto; padding:0 6px 0 2px;
}

/* 스크롤바 */
.chat-messages::-webkit-scrollbar{ width:10px; }
.chat-messages::-webkit-scrollbar-thumb{
  background:linear-gradient(180deg, #e1e7f5, #d9e5ff);
  border:2px solid transparent; background-clip: padding-box; border-radius:999px;
}

/* 메시지 행 */
.message-row{ display:flex; width:100%; gap:8px; }
.message-row.ai{ justify-content:flex-start; }
.message-row.user{ justify-content:flex-end; }

/* 아바타 */
.avatar{
  width:32px; height:32px; border-radius:50%;
  display:grid; place-items:center; font-size:1rem;
  background:linear-gradient(180deg,#eaf2ff,#eef5ff);
  border:1px solid rgba(125,125,125,.12);
  flex:0 0 auto;
}
.message-row.user .avatar{
  background:linear-gradient(180deg,#e9f2ff,#dceaff);
}

/* 말풍선 */
.message-bubble{
  max-width:min(76%, 560px);
  padding:12px 14px;
  border-radius:14px;
  font-size:.95rem; line-height:1.4;
  word-break:break-word;
  position:relative;
  box-shadow:0 6px 16px rgba(16,24,40,.08);
  border:1px solid rgba(125,125,125,.10);
}
.message-bubble.ai{
  background:var(--ai); color:var(--text);
  border-top-left-radius:6px;
}
.message-bubble.user{
  background:linear-gradient(180deg, var(--user), var(--brand-dark));
  color:#fff; border-top-right-radius:6px;
}

/* 메타 */
.meta{ margin-top:4px; font-size:.8rem; color:var(--muted); }
.message-row.user .meta{ text-align:right; }

/* 입력바 */
.chat-input-area{
  display:flex; align-items:center; gap:8px;
  background:linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.86));
  border:1px solid rgba(125,125,125,.12);
  border-radius:16px; padding:8px; box-shadow:0 8px 18px rgba(16,24,40,.06);
}
.chat-input{
  flex:1; border:none; background:transparent;
  padding:10px 12px; font-size:1rem; color:var(--text);
}
.chat-input:focus{ outline:none; }
.send-button{
  background:linear-gradient(180deg, var(--brand), var(--brand-dark));
  color:#fff; border:none; border-radius:12px;
  padding:10px 14px; font-weight:700; cursor:pointer;
  box-shadow:0 8px 18px rgba(124,170,235,.35);
  transition: transform .12s ease, box-shadow .2s ease, filter .2s ease;
}
.send-button:hover{ transform:translateY(-1px); box-shadow:0 12px 26px rgba(124,170,235,.45); }
.send-button:disabled{ opacity:.6; cursor:not-allowed; box-shadow:none; }

/* placeholder */
::placeholder{ color:#9aa3b2; }

/* 모바일 */
@media (max-width:480px){
  .chat-box{ padding:12px; border-radius:16px; }
  .message-bubble{ max-width: 86%; }
}

/* ── 말풍선 내부 피드백 ── */
.b-sep{ margin:10px -2px 8px; height:1px; background:rgba(255,255,255,.35); }
.message-bubble.ai .b-sep{ background:rgba(0,0,0,.12); }

.bfb{
  padding:0;
  background:transparent !important;
  box-shadow:none !important;
  color:inherit;
}

.bfb-head{ display:flex; align-items:center; gap:8px; margin-bottom:6px; }
.bfb-dot{ width:8px; height:8px; border-radius:999px; display:inline-block; }
.bfb-label{ font-weight:800; font-size:.82rem; }

.bfb-explain{ font-size:.9rem; line-height:1.4; margin-bottom:6px; }
.bfb-sg-title{ font-weight:700; font-size:.82rem; opacity:.9; margin-bottom:2px; }
.bfb-sg-text{ line-height:1.35; }

.message-bubble.user .bfb-label{ color: rgba(255,255,255,.95); }
.message-bubble.user .bfb-explain,
.message-bubble.user .bfb-sg-title,
.message-bubble.user .bfb-sg-text{ color: rgba(255,255,255,.86); }

.message-bubble.ai .bfb-label{ color:#334155; }
.message-bubble.ai .bfb-explain{ color: var(--muted); }
.message-bubble.ai .bfb-sg-title{ color:#475569; }
.message-bubble.ai .bfb-sg-text{ color: var(--text); }

.bfb-dot.bfb-perfect{ background:#22c55e; }
.bfb-dot.bfb-neutral{ background:#3b82f6; }
.bfb-dot.bfb-needs{ background:#ef4444; }

.bfb{ overflow-wrap:anywhere; }

@media (max-width:480px){
  .bfb{ padding:8px; font-size:.9rem; }
  .b-sep{ margin:8px -2px 6px; }
}

.inline-feedback, .fb2-card{ display:none !important; }
/* Voice와 동일한 토픽 카드 스타일 */
.voice-topic-grid { margin-top:.5rem; display:grid; grid-template-columns:1fr; gap:.5rem; }
.voice-topic-item { display:flex; align-items:center; gap:.75rem; padding:.75rem; border:1px solid #eee; border-radius:12px; background:#fcfcfc; cursor:pointer; }
.voice-topic-item:hover { background:#f6f6f6; }
.voice-topic-emoji { font-size:1.5rem; }
.voice-topic-main { flex:1; }
.voice-topic-title { font-weight:700; }
.voice-topic-desc { font-size:.9rem; color:#666; }
.voice-topic-chevron { color:#bbb; }


/* Voice와 동일한 토픽 카드 */
.voice-topic-overlay { padding:1rem; }
.voice-topic-card {
  background:#fff; border:1px solid #eee; border-radius:12px; padding:1rem;
}
.voice-topic-card h3 { margin:0 0 8px; text-align:left; color:var(--text); font-size:1.1rem; font-weight:800; }
.voice-topic-grid { margin-top:.5rem; display:grid; grid-template-columns:1fr; gap:.5rem; }
.voice-topic-item {
  display:flex; align-items:center; gap:.75rem; padding:.75rem;
  border:1px solid #eee; border-radius:12px; background:#fcfcfc; cursor:pointer;
}
.voice-topic-item:hover { background:#f6f6f6; }
.voice-topic-emoji { font-size:1.5rem; }
.voice-topic-main { flex:1; }
.voice-topic-title { font-weight:700; }
.voice-topic-desc { font-size:.9rem; color:#666; }
.voice-topic-chevron { color:#bbb; }

/* 상단바 (Voice 동일) */
.voice-topbar {
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:.75rem 1rem;
  border-bottom:1px solid #eee;
}
.back-btn {
  border:none;
  background:transparent;
  font-size:1.25rem;
  cursor:pointer;
}
.voice-chat-header {
  font-weight:700;
  font-size:1rem;
}
.exit-chip {
  border:1px solid #ddd;
  background:#f8f8f8;
  padding:.25rem .6rem;
  border-radius:999px;
  font-size:.85rem;
  cursor:pointer;
}
.spacer { width:24px; }
